#!/usr/bin/env python

import sys, os, subprocess
this_dir = os.path.dirname(sys.argv[0])
compiler = os.path.join(this_dir, "compile_variant.py")

def icompile(f):
    with open("/dev/null", "w") as null:
        res = subprocess.check_output(["python", compiler, f], stderr = null)
        return res.strip()

def maybe_compile(f):
    if f.endswith(".imp"):
        return icompile(f)
    else:
        return f

new_args = [ maybe_compile(f) for f in sys.argv[1:] ]

os.execvp(new_args[0], new_args)
