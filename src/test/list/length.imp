mklist(n) {
    if n = 0 then Nil else {
        let h = _ in
        let m = n + -1 in
        let t = mkref mklist(m) in
        Cons h t
    }
}

len(l) {
    match l with
      Nil -> return 0
    | Cons h t -> {
        let t_der = *t in
        let n = 1 + len(t_der) in {
            alias(t_der = *t);
            alias(l.Cons.2 = t);
            return n
        }
    }
}

{
    let n = ( _ : ~ >= 0) in
    let l = mklist(n) in
    assert(len(l) = n)
}